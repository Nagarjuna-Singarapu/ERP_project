{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Employee Leave</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  {% block css %}
  <link rel="stylesheet" href="{% static 'hrms_css/emp_res_lea/add_emp_leave.css' %}">
  {% endblock %}


</head>

<body>
  <div class="container my-4" id="column-container">
    <div class="form-section">
      <h1 class="h4 mb-4">Add Employee Leave</h1>

      <form id="addLeaveForm">
        <div class="row g-3">
          <!-- Party ID  -->
          <div class="col-md-4">
            <label for="applyingParty" class="form-label">Party ID</label>
            <div class="input-group">
                <input type="text" id="applyingParty" class="form-control" placeholder="Enter Party ID"
                    aria-label="Party ID">
                <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal"
                    data-bs-target="#partyIDModal">
                    <i class="fas fa-info-circle"></i>
                </button>
            </div>
        </div>
          <!-- Leave Type ID -->
          <div class="col-md-4">
            <label for="leaveTypeID" class="form-label">Leave Type ID <span class="form-required">*</span></label>
            <select id="leaveTypeID" class="form-select" required>
              <option value="">Select Leave Type</option>
              <option value="1">Casual</option>
              <option value="2">Sick</option>
              <option value="3">Paid</option>
              <option value="4">Unpaid</option>
            </select>
          </div>

          <!-- Leave Reason Type -->
          <div class="col-md-4">
            <label for="leaveReasonType" class="form-label">Leave Reason Type <span
                class="form-required">*</span></label>
            <select id="leaveReasonType" class="form-select" required>
              <option value="">Select Reason</option>
              <option value="1">Casual</option>
              <option value="2">Medical</option>
              <option value="3">Other</option>
            </select>
          </div>

          <!-- From Date -->
          <div class="col-md-4">
            <label for="fromDate" class="form-label">From Date <span class="form-required">*</span></label>
            <input type="date" id="fromDate" class="form-control" required />
          </div>

          <!-- Through Date -->
          <div class="col-md-4">
            <label for="throughDate" class="form-label">Through Date</label>
            <input type="date" id="throughDate" class="form-control" />
          </div>

          <!-- Approver Party -->
          <div class="col-md-4">
            <label for="approverParty" class="form-label">Approver Party <span class="form-required">*</span></label>
            <input type="text" id="approverParty" class="form-control" placeholder="Enter Approver Party" required />
          </div>

          <!-- Description -->
          <div class="col-md-12">
            <label for="description" class="form-label">Description</label>
            <textarea id="description" class="form-control" rows="3"
              placeholder="Enter description (optional)"></textarea>
          </div>

          <!-- Modals for Party ID -->
          <div class="modal fade" id="partyIDModal" tabindex="-1" aria-labelledby="partyIDModalLabel"
          aria-hidden="true">
          <div class="modal-dialog modal-lg">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="partyIDModalLabel">Party ID Details</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                      <iframe src="{% url 'lookup_party' %}" width="100%" height="400px" frameborder="0"></iframe>
                  </div>
              </div>
          </div>
      </div>

          <!-- Create Button -->
          <div class="col-12">
            <button type="button" class="btn btn-primary" id="createBtn">
              Create
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const createBtn = document.getElementById("createBtn");

      // Placeholder for submit action
      createBtn.addEventListener("click", function () {
        const formData = {
          partyID: document.getElementById("partyID").value,
          leaveTypeID: document.getElementById("leaveTypeID").value,
          fromDate: document.getElementById("fromDate").value,
          leaveReasonType: document.getElementById("leaveReasonType").value,
          throughDate: document.getElementById("throughDate").value,
          approverParty: document.getElementById("approverParty").value,
          description: document.getElementById("description").value,
        };

        // Here you would send the formData to the backend using fetch or AJAX
        console.log("Form Data Submitted:", formData);

        // Simulating a submission alert
        alert("Employee Leave created successfully!");
      });
    });


    // Fetch query parameters from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const partyID = urlParams.get('partyID');

    // Simulate fetching data based on Party ID
    // In real implementation, you would fetch this data from your backend
    const leaveRecords = [
      { partyID: 'ACCOUNTING', leaveType: 'Loss of Pay', leaveReason: 'Casual', fromDate: '2024-10-24', throughDate: '2024-10-25' }
    ];

    // Populate the form with the fetched data
    const record = leaveRecords.find(record => record.partyID === partyID);
    if (record) {
      document.getElementById('partyID').value = record.partyID;
      document.getElementById('leaveType').value = record.leaveType;
      document.getElementById('leaveReason').value = record.leaveReason;
      document.getElementById('fromDate').value = record.fromDate;
      document.getElementById('throughDate').value = record.throughDate;
    }
  </script>
</body>

</html>